{"remainingRequest":"C:\\Users\\12130\\Desktop\\电商实时监控平台\\vision\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\12130\\Desktop\\电商实时监控平台\\vision\\src\\components\\Trend.vue?vue&type=style&index=0&id=0041d71d&lang=less&scoped=true&","dependencies":[{"path":"C:\\Users\\12130\\Desktop\\电商实时监控平台\\vision\\src\\components\\Trend.vue","mtime":1624006352258},{"path":"C:\\Users\\12130\\Desktop\\电商实时监控平台\\vision\\node_modules\\css-loader\\dist\\cjs.js","mtime":1615108059555},{"path":"C:\\Users\\12130\\Desktop\\电商实时监控平台\\vision\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1615108060518},{"path":"C:\\Users\\12130\\Desktop\\电商实时监控平台\\vision\\node_modules\\postcss-loader\\src\\index.js","mtime":1611403627919},{"path":"C:\\Users\\12130\\Desktop\\电商实时监控平台\\vision\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\12130\\Desktop\\电商实时监控平台\\vision\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1615108034129},{"path":"C:\\Users\\12130\\Desktop\\电商实时监控平台\\vision\\node_modules\\vue-loader\\lib\\index.js","mtime":1615108060518}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi50aXRsZXsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBsZWZ0OiAyMHB4Ow0KICB0b3A6IDIwcHg7DQogIHotaW5kZXg6IDEwOw0KICBjb2xvcjogd2hpdGU7DQp9DQoudGl0bGUtaWNvbnsNCiAgICBtYXJnaW4tbGVmdDogMTBweDsNCiAgICBjdXJzb3I6cG9pbnRlcjsNCiAgfQ0KLnNlbGVjdC1jb257DQogIGJhY2tncm91bmQtY29sb3I6ICMyMjI3MzM7DQp9DQo="},{"version":3,"sources":["Trend.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Trend.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <!-- 销量趋势图表 -->\r\n    <div class=\"com-container\">\r\n      <div class=\"title\" :style=\"comStyle\">\r\n        <span>{{'┃ ' + showTitle}}</span>\r\n        <span class=\"iconfont title-icon\" :style=\"comStyle\" @click=\"showChoice = !showChoice\">&#xe6eb;</span>\r\n        <div class=\"select-con\" v-show=\"showChoice\" :style=\"marginStyle\">\r\n          <div class=\"select-item\" v-for=\"item in selectTypes\" :key = \"item.key\" @click=\"handleSelect(item.key)\">\r\n            {{ item.text }}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"com-chart\" ref=\"trend_ref\"></div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapState } from 'vuex'\r\nimport { getThemeValue } from '@/utils/theme_utils'\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      chartInstance: null,\r\n      allData: null,\r\n      showChoice: false, // 是否显示可选项\r\n      choiceType: 'map', // 显示数据类型\r\n      titleFontSize: 0 // 指明标题的字体大小\r\n    }\r\n  },\r\n  created () {\r\n    // 在组件创建完成之后，进行回调函数的注册\r\n    this.$socket.registerCallBack('trendData', this.getData)\r\n  },\r\n  mounted () {\r\n    this.initChart()\r\n    // this.getData()\r\n    // 发送数据给服务器，告诉服务器，我现在需要数据\r\n    this.$socket.send({\r\n      action: 'getData',\r\n      socketType: 'trendData',\r\n      charName: 'trend',\r\n      value: ''\r\n    })\r\n    window.addEventListener('resize', this.screenAdapter)\r\n    this.screenAdapter()\r\n  },\r\n  destroyed () {\r\n    window.removeEventListener('resize', this.screenAdapter)\r\n    // 在组件销毁的时候，进行回调函数的取消\r\n    this.$socket.unRegisterCallBack('trendData')\r\n  },\r\n  watch: {\r\n    theme () {\r\n      this.chartInstance.dispose()\r\n      this.initChart()\r\n      this.screenAdapter()\r\n      this.updatedChart()\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState(['theme']),\r\n    selectTypes () {\r\n      if (!this.allData) {\r\n        return []\r\n      } else {\r\n        // 隐藏已经显示的标题\r\n        return this.allData.type.filter(item => {\r\n          return item.key !== this.choiceType\r\n        })\r\n      }\r\n    },\r\n    showTitle () {\r\n      if (!this.allData) {\r\n        return ''\r\n      } else {\r\n        return this.allData[this.choiceType].title\r\n      }\r\n    },\r\n    comStyle () {\r\n      return {\r\n        fontSize: this.titleFontSize + 'px',\r\n        color: getThemeValue(this.theme).titleColor\r\n      }\r\n    },\r\n    marginStyle () {\r\n      return {\r\n        marginLeft: this.titleFontSize + 'px',\r\n        backgroundColor: getThemeValue(this.theme).backgroundColor,\r\n        color: getThemeValue(this.theme).titleColor\r\n      }\r\n    }\r\n\r\n  },\r\n  methods: {\r\n    initChart () {\r\n      this.chartInstance = this.$echarts.init(this.$refs.trend_ref, this.theme)\r\n      const initOption = {\r\n        grid: {\r\n          letf: '3%',\r\n          top: '35%',\r\n          right: '4%',\r\n          bottom: '1%',\r\n          containLabel: true\r\n        },\r\n        // 工具提示\r\n        tooltip: {\r\n          trigger: 'axis'\r\n        },\r\n        // 图例\r\n        legend: {\r\n          left: 20,\r\n          top: '15%',\r\n          icon: 'circle'\r\n        },\r\n        xAxis: {\r\n          type: 'category',\r\n          // 无缝\r\n          boundary: false\r\n        },\r\n        yAxis: {\r\n          type: 'value'\r\n        }\r\n      }\r\n      this.chartInstance.setOption(initOption)\r\n    },\r\n    // ret 就是服务端发送给客户端的图表的数据\r\n    // async getData (ret) {\r\n    getData (ret) {\r\n      // await this.$http.get()\r\n      // 对allData进行赋值\r\n      // const { data: ret } = await this.$http.get('trend')\r\n      // console.log(ret)\r\n      this.allData = ret\r\n      // console.log(ret)\r\n      this.updatedChart()\r\n    },\r\n    updatedChart () {\r\n      // 半透明的颜色值\r\n      const colorArr1 = [\r\n        'rgba(11, 168, 44, 0.5)',\r\n        'rgba(44, 110, 255, 0.5)',\r\n        'rgba(22, 242, 217, 0.5)',\r\n        'rgba(254, 33, 30, 0.5)',\r\n        'rgba(250, 105, 0, 0.5)'\r\n      ]\r\n      // 全透明的颜色值\r\n      const colorArr2 = [\r\n        'rgba(11, 168, 44, 0)',\r\n        'rgba(44, 110, 255, 0)',\r\n        'rgba(22, 242, 217, 0)',\r\n        'rgba(254, 33, 30, 0)',\r\n        'rgba(250, 105, 0, 0)'\r\n      ]\r\n\r\n      // 处理数据\r\n      // 类目轴的数据\r\n      const timeArr = this.allData.common.month\r\n      // y轴的数据series下的数据\r\n      const valueArr = this.allData[this.choiceType].data\r\n      const seriesArr = valueArr.map((item, index) => {\r\n        return {\r\n          name: item.name,\r\n          type: 'line',\r\n          data: item.data,\r\n          stack: this.choiceType,\r\n          areaStyle: {\r\n            color: new this.$echarts.graphic.LinearGradient(0, 0, 0, 1, [\r\n              // 百分之0 的颜色值\r\n              {\r\n                offset: 0,\r\n                color: colorArr1[index]\r\n              },\r\n              // 百分之百的颜色值\r\n              {\r\n                offset: 1,\r\n                color: colorArr2[index]\r\n              }\r\n            ])\r\n          }\r\n        }\r\n      })\r\n      // 图例的数据\r\n      const legenArr = valueArr.map(item => {\r\n        return item.name\r\n      })\r\n      const dataOption = {\r\n        xAxis: {\r\n          data: timeArr\r\n        },\r\n        legend: {\r\n          data: legenArr\r\n        },\r\n        series: seriesArr\r\n      }\r\n      this.chartInstance.setOption(dataOption)\r\n    },\r\n    screenAdapter () {\r\n      this.titleFontSize = this.$refs.trend_ref.offsetWidth / 100 * 3.6\r\n      const adapterOption = {\r\n        legend: {\r\n          itemWidth: this.titleFontSize,\r\n          itemHeight: this.titleFontSize,\r\n          itemGap: this.titleFontSize,\r\n          textStyle: {\r\n            fontSize: this.titleFontSize / 2\r\n          }\r\n        }\r\n      }\r\n      this.chartInstance.setOption(adapterOption)\r\n      this.chartInstance.resize()\r\n    },\r\n    handleSelect (currentType) {\r\n      this.choiceType = currentType\r\n      this.updatedChart()\r\n      this.showChoice = false\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.title{\r\n  position: absolute;\r\n  left: 20px;\r\n  top: 20px;\r\n  z-index: 10;\r\n  color: white;\r\n}\r\n.title-icon{\r\n    margin-left: 10px;\r\n    cursor:pointer;\r\n  }\r\n.select-con{\r\n  background-color: #222733;\r\n}\r\n</style>\r\n"]}]}